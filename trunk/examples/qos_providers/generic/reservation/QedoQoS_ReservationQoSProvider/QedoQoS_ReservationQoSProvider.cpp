//
// generated by Qedo
//

#include "QedoQoS_ReservationQoSProvider.h"


// BEGIN USER INSERT SECTION file
// END USER INSERT SECTION file


namespace QedoQoS {


// BEGIN USER INSERT SECTION ReservationQoSproviderImpl
void
ReservationQoSproviderImpl::register_copis()
{
	std::cout << "ReservationQoSProvider: register_copis" << std::endl;

	client_interceptor_ = new QedoQoS_Reservation::ClientContainerInterceptor(context_, this);
	server_interceptor_ = new QedoQoS_Reservation::ServerContainerInterceptor(context_, this);

	//server
	Components::Extension::ServerInterceptorRegistration_ptr server_reg =
		context_->get_server_interceptor_dispatcher_registration();
	server_reg->register_interceptor_for_all(server_interceptor_);

	//Client
	Components::Extension::ClientInterceptorRegistration_ptr client_reg =
		context_->get_client_interceptor_dispatcher_registration();
	client_reg->register_interceptor_for_all(client_interceptor_);

	//Servant
	Components::Extension::ServantInterceptorRegistration_ptr servant_reg =
		context_->get_servant_interceptor_dispatcher_registration();
	servant_reg->register_interceptor_for_all(server_interceptor_);

	//Stub
	Components::Extension::StubInterceptorRegistration_ptr stub_reg =
		context_ -> get_stub_interceptor_dispatcher_registration();
	stub_reg -> register_interceptor_for_all(client_interceptor_);
}

void
ReservationQoSproviderImpl::unregister_copis()
{
	std::cout << "ReservationQoSProvider: unregister_copis" << std::endl;

	//server
	Components::Extension::ServerInterceptorRegistration_ptr server_reg =
		context_->get_server_interceptor_dispatcher_registration();
	server_reg->unregister_interceptor_for_all(server_interceptor_);

	//Client
	Components::Extension::ClientInterceptorRegistration_ptr client_reg =
		context_->get_client_interceptor_dispatcher_registration();
	client_reg->register_interceptor_for_all(client_interceptor_);

	//Servant
	Components::Extension::ServantInterceptorRegistration_ptr servant_reg =
		context_->get_servant_interceptor_dispatcher_registration();
	servant_reg->register_interceptor_for_all(server_interceptor_);

	//Stub
	Components::Extension::StubInterceptorRegistration_ptr stub_reg =
		context_ -> get_stub_interceptor_dispatcher_registration();
	stub_reg -> unregister_interceptor_for_all(client_interceptor_);
}

// END USER INSERT SECTION ReservationQoSproviderImpl


ReservationQoSproviderImpl::ReservationQoSproviderImpl()
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::ReservationQoSproviderImpl
// END USER INSERT SECTION ReservationQoSproviderImpl::ReservationQoSproviderImpl
}


ReservationQoSproviderImpl::~ReservationQoSproviderImpl()
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::~ReservationQoSproviderImpl
// END USER INSERT SECTION ReservationQoSproviderImpl::~ReservationQoSproviderImpl

}


void
ReservationQoSproviderImpl::set_context(::QedoQoS::CCM_Reservation_ContextImpl_ptr context)
    throw (CORBA::SystemException, Components::CCMException)
{
    context_ = ::QedoQoS::CCM_Reservation_ContextImpl::_duplicate(context);
}


void
ReservationQoSproviderImpl::configuration_complete()
    throw (CORBA::SystemException, Components::InvalidConfiguration)
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::configuration_complete
	// create interceptors

	//register interceptors
	
// END USER INSERT SECTION ReservationQoSproviderImpl::configuration_complete
}


void
ReservationQoSproviderImpl::remove()
    throw (CORBA::SystemException)
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::remove
// END USER INSERT SECTION ReservationQoSproviderImpl::remove
}


void
ReservationQoSproviderImpl::trigger_negotiation()
	throw(CORBA::SystemException)
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::trigger_negotiation
// END USER INSERT SECTION ReservationQoSproviderImpl::trigger_negotiation
}


Components::Extension::ContractDescription*
ReservationQoSproviderImpl::req_offer(const Components::Extension::ContractDescription& requirements)
	throw(CORBA::SystemException)
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::req_offer
	std::cout << "@@@@@@@@ got req_contract" << std::endl;
	// check for availability

	// create offer

	// store offer information and reserver resources for the offer

	// return offer
	return new Components::Extension::ContractDescription(requirements); 
// END USER INSERT SECTION ReservationQoSproviderImpl::req_offer
}


CORBA::Boolean
ReservationQoSproviderImpl::accept(const Components::Extension::ContractDescription& requirements)
	throw(CORBA::SystemException)
{
// BEGIN USER INSERT SECTION ReservationQoSproviderImpl::accept

	// check for offer reservation

	// use ressources

	// store contract info

	// return an identfier
	// true meanwhile
	return true;
// END USER INSERT SECTION ReservationQoSproviderImpl::accept
}


// BEGIN USER INSERT SECTION ReservationQoSProvider
// END USER INSERT SECTION ReservationQoSProvider


ReservationQoSProvider::ReservationQoSProvider()
:component_(new ReservationQoSproviderImpl())
{
// BEGIN USER INSERT SECTION ReservationQoSProvider::ReservationQoSProvider
// END USER INSERT SECTION ReservationQoSProvider::ReservationQoSProvider
}


ReservationQoSProvider::~ReservationQoSProvider()
{
// BEGIN USER INSERT SECTION ReservationQoSProvider::~ReservationQoSProvider
// END USER INSERT SECTION ReservationQoSProvider::~ReservationQoSProvider

    component_->_remove_ref();
}


::CORBA::Object*
ReservationQoSProvider::obtain_executor(const char* name)
    throw (CORBA::SystemException)
{
    if (! strcmp ( name, "component" ) ) {
        return Components::EnterpriseComponent::_duplicate (component_);
    }
    
    else if (! strcmp (name, "nego_external")) {
        return Components::EnterpriseComponent::_duplicate (component_);
    }
    
    return Components::EnterpriseComponent::_nil();
}


void
ReservationQoSProvider::release_executor(::CORBA::Object_ptr executor)
    throw (CORBA::SystemException)
{
    CORBA::release (executor);
}


void
ReservationQoSProvider::configuration_complete()
    throw (CORBA::SystemException, Components::InvalidConfiguration)
{
    component_->configuration_complete();

// BEGIN USER INSERT SECTION ReservationQoSProvider::configuration_complete
// END USER INSERT SECTION ReservationQoSProvider::configuration_complete
}


void
ReservationQoSProvider::set_extension_context(::Components::ExtensionContext_ptr context)
    throw (CORBA::SystemException, Components::CCMException)
{
    #ifdef TAO_ORB
    ::QedoQoS::CCM_Reservation_Context_ptr tmp_context;
    
    tmp_context = dynamic_cast<::QedoQoS::CCM_Reservation_ContextImpl*>(context);
    
    if (tmp_context)
        context_ = ::QedoQoS::CCM_Reservation_ContextImpl::_duplicate(tmp_context);
    else
        context_ = ::QedoQoS::CCM_Reservation_ContextImpl::_nil();
        
    #else
    context_ = ::QedoQoS::CCM_Reservation_ContextImpl::_narrow(context);
    
    #endif
    component_->set_context(context_);
}


void
ReservationQoSProvider::ccm_activate()
    throw (CORBA::SystemException, Components::CCMException)
{
// BEGIN USER INSERT SECTION ReservationQoSProvider::ccm_activate

	component_ -> register_copis();

// END USER INSERT SECTION ReservationQoSProvider::ccm_activate
}


void
ReservationQoSProvider::ccm_passivate()
    throw (CORBA::SystemException, Components::CCMException)
{
// BEGIN USER INSERT SECTION ReservationQoSProvider::ccm_passivate
	component_ -> unregister_copis();
// END USER INSERT SECTION ReservationQoSProvider::ccm_passivate
}


void
ReservationQoSProvider::ccm_remove()
    throw (CORBA::SystemException, Components::CCMException)
{
// BEGIN USER INSERT SECTION ReservationQoSProvider::ccm_remove
// END USER INSERT SECTION ReservationQoSProvider::ccm_remove
}


// BEGIN USER INSERT SECTION ReservationQoSProviderHomeImpl
// END USER INSERT SECTION ReservationQoSProviderHomeImpl


ReservationQoSProviderHomeImpl::ReservationQoSProviderHomeImpl()
{
// BEGIN USER INSERT SECTION ReservationQoSProviderHomeImpl::ReservationQoSProviderHomeImpl
// END USER INSERT SECTION ReservationQoSProviderHomeImpl::ReservationQoSProviderHomeImpl
}


ReservationQoSProviderHomeImpl::~ReservationQoSProviderHomeImpl()
{
// BEGIN USER INSERT SECTION ReservationQoSProviderHomeImpl::~ReservationQoSProviderHomeImpl
// END USER INSERT SECTION ReservationQoSProviderHomeImpl::~ReservationQoSProviderHomeImpl

}


void
ReservationQoSProviderHomeImpl::set_context(Components::HomeContext_ptr ctx)
    throw (CORBA::SystemException, Components::CCMException)
{
    context_ = Components::HomeContext::_duplicate(ctx);
    
}


::Components::EnterpriseComponent_ptr
ReservationQoSProviderHomeImpl::create ()
    throw (CORBA::SystemException, Components::CreateFailure)
{
// BEGIN USER INSERT SECTION ReservationQoSProviderHomeImpl::create
// END USER INSERT SECTION ReservationQoSProviderHomeImpl::create
    return new ReservationQoSProvider();
}


};


//
// entry point
//
::Components::HomeExecutorBase_ptr
create_ReservationHomeE(void)
{
// BEGIN USER INSERT SECTION create_ReservationHome
// END USER INSERT SECTION create_ReservationHome

    return new ::QedoQoS::ReservationQoSProviderHomeImpl();
}

